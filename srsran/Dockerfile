# ============================================
# srsRAN 5G + Ettus B205mini-i (UHD) â€” Plug & Play
# ============================================
FROM ubuntu:22.04

ENV DEBIAN_FRONTEND=noninteractive

# ğŸ”§ InstalÄƒm tot ce e necesar pentru UHD + srsRAN + USB + debugging
RUN apt update && apt install -y \
    cmake build-essential git wget curl \
    libfftw3-dev libsctp-dev iproute2 iputils-ping \
    libboost-program-options-dev libconfig++-dev \
    libuhd-dev uhd-host libmbedtls-dev libyaml-cpp-dev \
    gnuradio udev sudo usbutils \
    libdw-dev binutils-dev libdwarf-dev && apt clean

# ğŸ”Œ DescÄƒrcare automatÄƒ imagini UHD pentru Ettus (FPGA + firmware)
RUN uhd_images_downloader

# ğŸ§  ConfigurÄƒm udev pentru acces la USB fÄƒrÄƒ restricÈ›ii (Ã®n container)
RUN echo 'SUBSYSTEM=="usb", MODE="0666", GROUP="plugdev"' > /etc/udev/rules.d/99-usrp.rules

# ğŸ” ActivÄƒm udev service Ã®n container
RUN apt install -y systemd udev && systemctl enable systemd-udevd.service || true

# âš™ï¸ Copiem sursa srsRAN (va fi montatÄƒ extern sau preinclusÄƒ)
COPY external/srsran-src /srsran-src
WORKDIR /srsran-src

# ğŸ—ï¸ Build srsRAN din sursÄƒ
RUN mkdir build && cd build && \
    cmake .. -DCMAKE_VERBOSE_MAKEFILE=ON && \
    make -j$(nproc) && make install && ldconfig

# ğŸ§¾ Copiem scriptul de pornire
COPY scripts/start-gnb.sh /start-gnb.sh
RUN chmod +x /start-gnb.sh

# ğŸ” ExecutÄƒm la pornire
CMD ["/start-gnb.sh"]
